# 打字肉鸽 - 原型总结

## 项目概述

**游戏类型**: 打字 + Roguelike + 牌组构筑
**核心玩法**: 限时打字得分，通过技能和词库构筑增强实力
**灵感来源**: Balatro (小丑牌)、Backpack Battles

---

## 核心系统

### 1. 打字战斗系统

| 要素 | 设计 |
|------|------|
| 每关时长 | 30秒 + 时间加成 |
| 分数计算 | 字母基础分 × 倍率 + 词语奖励 |
| 连击系统 | 连续正确 +0.1 倍率/字母 |
| 失败条件 | 时间结束时未达目标分数 |

**分数公式**:
```
字母得分 = (1 + 字母加成) × 当前倍率
词语得分 = Σ字母得分 + 词语奖励
当前倍率 = 基础倍率 + 连击数 × 连击加成
```

### 2. 技能绑定系统

- 技能绑定到键盘按键 (QWERTY 布局)
- 打字触发对应按键的技能
- **相邻键联动**: 技能间根据键盘物理位置产生协同效果

**技能类型**:
| 类型 | 示例 | 效果 |
|------|------|------|
| 分数型 | 火花、爆发、星光 | 直接加分 |
| 倍率型 | 增幅、激涌 | 提升倍率 |
| 时间型 | 时钟、冻结 | 增加时间 |
| 连击型 | 连锁 | 增加连击数 |
| 防护型 | 护盾 | 保护连击不断 |
| 联动型 | 能量核心、光环、孤狼、共鸣、虚空、涟漪 | 根据相邻技能产生效果 |

**键盘相邻关系** (已实现):
```javascript
const ADJACENT_KEYS = {
    q: ['w', 'a'], w: ['q', 'e', 'a', 's'], ...
    // 基于 QWERTY 物理布局
};
```

### 3. 词语牌库系统

- 玩家拥有专属词库 (类似卡牌牌组)
- 战斗中随机从牌库抽取词语
- 商店可购买新词 / 删除旧词
- 词库统计: 词语数量、字母频率分布

**词库策略**:
- 高频字母词 → 配合对应技能绑定
- 短词 → 快速完成，触发更多技能
- 长词 → 单次高分

### 4. 遗物系统

被动效果，永久生效:
- **磁石**: 更高几率出现含技能字母的词
- **时间水晶**: 完成词语 +0.5 秒
- **存钱罐**: 每关开始 +5 金币
- **藏宝图**: 超额奖励翻倍
- **凤凰羽毛**: 50% 几率保护连击
- **狂战士面具**: 连击 >20 时分数 +50%
- **完美主义者**: 连续正确累计加成

### 5. 商店系统

每关结束进入商店:
- **技能页**: 购买新技能 / 升级已有技能
- **遗物页**: 购买遗物
- **牌库页**: 购买词语 / 删除词语 (逐次递增费用)

商品在进入商店时生成，切换标签不刷新。

---

## 动画与反馈系统 (Juice)

### 已验证有效的效果

| 效果 | 触发条件 | 实现方式 |
|------|----------|----------|
| 字母弹跳 | 打字正确 | CSS `juiceUp` 动画 |
| 连击数弹跳 | 连击增加 | CSS `combo-bump` |
| 分数弹跳 | 词语完成 | CSS `score-bump` |
| 倍率弹跳 | 技能触发 | CSS `mult-bump` |
| 分级震动 | 词语完成 | 根据分数调整震动强度 |
| 倍率发光 | 倍率 ≥1.5/2.5 | 屏幕边缘光晕 + 边框脉冲 |
| 技能图标浮动 | 持续 | CSS `card-float` |
| 字母入场 | 新词出现 | 依次从上方弹入 |
| 3D 卡牌倾斜 | 商店悬停 | 鼠标跟随 rotateX/Y |

### 弃用的效果

| 效果 | 弃用原因 |
|------|----------|
| 连击里程碑大字报 | 打断节奏，过于夸张 |
| 完美词语奖励 | 信息过多，分散注意力 |

### 关键动画参数

```css
/* 弹性缓动函数 - 核心手感 */
cubic-bezier(0.34, 1.56, 0.64, 1)

/* 弹跳动画时长 */
juice-up: 0.35s
juice-up-strong: 0.4s

/* 震动强度变量 */
--shake-x: 3px ~ 9px
--shake-y: 2px ~ 6px
```

---

## 数值平衡 (待正式调整)

### 当前测试数值

```javascript
// 关卡目标分数
targetScore = 80 + level * 40 + level² * 5

// 基础数值
baseMultiplier: 1.0
comboBonus: 0.1  // 每连击 +0.1 倍率

// 技能基础值
spark: 3分, burst: 5分, star: 8分
amp: +0.2倍率, surge: +0.3倍率
clock: +1秒, freeze: +2秒

// 商店价格
新技能: 15-30 金币
技能升级: 25 金币
新词语: 5-15 金币
删除词语: 1, 2, 3... 递增
```

### 倍率视觉反馈阈值

```javascript
mult >= 1.5  → mid-mult (金色光晕)
mult >= 2.5  → high-mult (红色脉冲)
```

### 震动强度阈值 (测试值)

```javascript
wordScore >= 20 → 强震 (intensity: 3)
wordScore >= 10 → 中震 (intensity: 2)
wordScore < 10  → 轻震 (intensity: 1)
```

---

## 技术实现要点

### 文件结构

```
prototype/
├── index.html    # 页面结构
├── style.css     # 样式 + 动画
└── game.js       # 游戏逻辑
```

### 关键代码模式

**状态管理**: 单一 `state` 对象
```javascript
const state = {
    level, phase, time, score, combo, multiplier,
    player: { bindings, skills, relics, wordDeck, ... },
    shop: { shopWords, shopSkills, shopRelics, ... }
};
```

**技能触发**: 基于 Map 的绑定查找
```javascript
const skillId = state.player.bindings.get(key);
if (skillId) triggerSkill(skillId, key);
```

**相邻检测**: 预定义邻接表
```javascript
const adjacent = ADJACENT_KEYS[key];
const adjacentSkills = adjacent.filter(k => bindings.has(k));
```

---

## 正式开发建议

### 优先级 P0 (核心体验)

1. 音效系统 - 当前仅有简单音调
2. 更多技能种类 - 丰富构筑选择
3. 数值平衡 - 正式调参
4. 难度曲线 - 关卡递进设计

### 优先级 P1 (内容扩展)

1. 更多遗物
2. 词库分类 (主题词库)
3. Boss 关卡
4. 成就系统

### 优先级 P2 (体验优化)

1. 教程引导
2. 存档系统
3. 统计面板
4. 皮肤/主题

### 技术栈建议

| 方案 | 优点 | 缺点 |
|------|------|------|
| 纯 Web (当前) | 开发快，跨平台 | 性能上限 |
| Godot + Web导出 | 功能完整，可发布多平台 | 学习成本 |
| Unity WebGL | 生态成熟 | 包体大 |

---

## 原型文件

- 原型代码: `/prototype/`
- 本文档: `/docs/prototype-summary.md`
